<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/procuOneHeader.css}">
</head>
<body>
<form th:action="@{/company/register}" method="post">
    <div>
        <h1>업체회원가입</h1>

        <!-- 이름 필드 -->
        <div>
            <label>이름:</label>
            <input class="addCompany" name="comManage" type="text" required> <!-- comManage : 관리자가 될 이름 -->
        </div>

        <!-- 업체명 필드 -->
        <div>
            <label>업체명:</label>
            <input class="addCompany" name="comName" type="text" required> <!-- comName : 업체명 -->
        </div>

        <!-- 아이디 필드 -->
        <div>
            <label>아이디:</label>
            <input class="addCompany" name="comId" type="text" id="comId" required> <!-- comId : 아이디 -->
            <button type="button" id="checkIdBtn">ID 중복 확인</button>
            <span id="idCheckResult"></span> <!-- 중복 여부 표시 -->
        </div>

        <!-- 비밀번호 필드 -->
        <div>
            <label>비밀번호:</label>
            <input class="addCompany" name="password" type="password" required>
        </div>

        <!-- 비밀번호 확인 필드 -->
        <div>
            <label>비밀번호 확인:</label>
            <input class="addCompany" name="password2" type="password" required>
        </div>

        <!-- 이메일 필드 -->
        <div>
            <label>이메일</label>
            <input class="addCompany" name="comEmail" type="text" placeholder="이메일 아이디" required> <!-- comEmail : 이메일 -->
            <input class="addCompany" name="emailDirect" id="emailDirect" placeholder="직접 입력" type="text">
            <select name="emailSelect" id="emailSelect">
                <option selected value="none">도메인 선택</option>
                <option value="naver.com">naver.com</option>
                <option value="gamil.com">gamil.com</option>
                <option value="daum.net">daum.net</option>
            </select>
        </div>

        <!-- 업체 연락처 필드 -->
        <div>
            <label>업체연락처</label>
            <input class="addCompany" name="comPhone" type="text" required> <!-- comPhone : 업체 연락처 -->
        </div>

        <!-- 사업자 번호 필드 -->
        <div>
            <label>사업자 번호:</label>
            <input class="addCompany" name="businessId" type="text" required> <!-- businessId : 사업자 번호 -->
        </div>

        <!-- 주소 필드 추가 (comAdd) -->
        <div>
            <label>주소:</label>
            <input class="addCompany" name="comAdd" type="text" required> <!-- comAdd : 주소 -->
        </div>

        <!-- 은행명 필드-->
        <div>
            <label>은행명:</label>
            <input class="addCompany" name="comBank" type="text" required> <!-- comBank : 은행 -->
        </div>

        <!-- 회사 계좌 필드 -->
        <div>
            <label>계좌:</label>
            <input class="addCompany" name="comAccountNumber" type="text" required> <!-- comAccount : 계좌  계좌 양식 111-1111-1111-11-->
        </div>


        <!-- 제출 버튼 -->
        <div>
            <button type="submit">확인</button>
            <button type="reset">취소</button>
        </div>
    </div>
</form>

<script>
    // 아이디 중복 확인 버튼 클릭 시
    document.getElementById("checkIdBtn").addEventListener("click", function() {
        const memberId = document.getElementById("comId").value;

        if (!memberId) {
            alert("아이디를 입력하세요.");
            return;
        }

        // Ajax 요청으로 중복 아이디 확인
        fetch(`/check-id?memberId=${memberId}`)
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    document.getElementById("idCheckResult").innerText = "이미 존재하는 아이디입니다.";
                    document.getElementById("idCheckResult").style.color = "red";
                } else {
                    document.getElementById("idCheckResult").innerText = "사용 가능한 아이디입니다.";
                    document.getElementById("idCheckResult").style.color = "green";
                }
            })
            .catch(error => {
                console.error("아이디 중복 확인 오류:", error);
            });
    });

    document.querySelector('form').addEventListener('submit', function(event) {
        event.preventDefault();  // 폼 제출을 막는다

        const comId = document.querySelector('input[name=comId]').value;  // 업체 아이디
        const comManage = document.querySelector('input[name=comManage]').value;  // 관리 이름
        const password = document.querySelector('input[name=password]').value;   //비밀번호
        const password2 = document.querySelector('input[name=password2]').value; //비밀번호 확인
        const comName = document.querySelector('input[name=comName]').value;  // 업체명
        const comPhone = document.querySelector('input[name=comPhone]').value;  // 업체 연락처
        const businessId = document.querySelector('input[name=businessId]').value;  // 사업자번호
        const comEmail = document.querySelector('input[name=comEmail]').value;  // 이메일 아이디
        const emailDirect = document.querySelector('input[name=emailDirect]').value; // 직접 입력된 도메인
        const emailSelect = document.querySelector('select[name=emailSelect]').value; // 선택된 도메인
        const comAdd = document.querySelector('input[name=comAdd]').value;  // 주소
        const comBank = document.querySelector('input[name=comBank]').value; //은행
        const comAccountNumber = document.querySelector('input[name=comAccountNumber]').value; // 계좌

        let Useremail = '';

        // 이메일 결합 로직: emailDirect와 emailSelect 둘 중 하나만 사용해야 함
        if (emailDirect && emailSelect !== 'none') {
            // 둘 다 입력될 수 없으므로 경고 메시지 표시
            alert('이메일 아이디와 도메인은 하나만 입력해야 합니다.');
            event.preventDefault();
            return;
        } else if (emailDirect) {
            // emailDirect만 입력된 경우, 이메일 아이디 + 도메인 결합
            Useremail = `${comEmail}@${emailDirect}`;
        } else if (emailSelect !== 'none') {
            // emailSelect만 선택된 경우, email 필드에 입력된 아이디와 결합
            if (!comEmail) {
                alert('이메일 아이디를 입력해주세요.');
                event.preventDefault();
                return;
            }
            Useremail = `${comEmail}@${emailSelect}`;
        } else {
            // emailDirect와 emailSelect가 모두 비어있을 경우
            alert('이메일 아이디 또는 도메인을 선택해주세요.');
            event.preventDefault();
            return;
        }

        // 이메일 형식 검사
        function validateEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        // 이메일 형식 검사
        if (!validateEmail(Useremail)) {
            alert('유효하지 않은 이메일 주소입니다.');
            event.preventDefault();
            return;
        }

        // 필수 입력 확인
        if (!comName || !comId || !password || !password2 || !comManage || !Useremail || !businessId || !comPhone || !comAdd ||!comBank || !comAccountNumber) {
            alert('아이디, 비밀번호, 이름, 이메일, 사업자번호, 연락처, 주소, 은행, 계좌는 필수 입력 항목입니다.');
            return;
        } else if (password !== password2) {
            alert('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
            event.preventDefault();
            return;
        }

        // **email 필드에 생성된 이메일 주소 값을 설정**
        document.querySelector('input[name="comEmail"]').value = Useremail; // 이메일을 comEmail 필드에 설정

        // 모든 조건을 통과하면 폼 제출
        this.submit();
    });
</script>

</body>
</html>
