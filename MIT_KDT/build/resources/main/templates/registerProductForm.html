<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>품목등록</title>
    <link rel="stylesheet" th:href="@{/css/procuOneHeader.css}">
</head>
<body>
<div th:replace="partials/procuOneHeader :: header"></div>
<h1>품목등록</h1>

<form th:action="@{/items/InputProduct}" th:object="${item}" method="post" enctype="multipart/form-data" onsubmit="combineDimensions()">
    <!-- 제품 코드 -->
    <div>
        <label for="productCode">제품 코드</label>
        <input type="text" th:field="*{productCode}" id="productCode" name="productCode" required/>
    </div>

    <!-- 품목명 -->
    <div>
        <label for="itemName">품목명</label>
        <input type="text" th:field="*{itemName}" id="itemName" name="itemName" required/>
    </div>

    <!-- 규격 -->
    <div>
        <label>규격</label>
        <input type="text" id="width" placeholder="가로(mm)" required/>
        <input type="text" id="height" placeholder="세로(mm)" required/>
        <input type="text" id="depth" placeholder="높이(mm)" required/>
        <input type="hidden" th:field="*{dimensions}" id="dimensions" name="dimensions" />
    </div>

    <!-- 분류 -->
    <div id="categoryDiv">
        <label>분류</label>
        <select id="largeCategory" onchange="updateMiddleCategory()">
            <option value="">== 대분류 선택 ==</option>
            <option th:each="category : ${categories}"
                    th:value="${category.id}"
                    th:text="${category.name}"
                    th:if="${category.type == '대분류'}"></option>
        </select>

        <select id="middleCategory" onchange="updateSmallCategory()">
            <option value="">== 중분류 선택 ==</option>
        </select>

        <select id="smallCategory">
            <option value="">== 소분류 선택 ==</option>
        </select>
    </div>

    <!-- 도면파일 -->
    <div>
        <label for="drawingFile">도면파일</label>
        <input type="file" th:field="*{drawingFile}" id="drawingFile" name="drawingFile" />
    </div>

    <!-- 확인 버튼 -->
    <div>
        <button type="submit">확인</button>
        <button type="button" onclick="window.history.back()">취소</button>
    </div>
</form>

<script>
    // JSON 형태로 Thymeleaf에서 제공하는 카테고리 데이터
    const categories = /*[[${#json.write(categories)}]]*/ {};

    function combineDimensions() {
        const width = document.getElementById("width").value;
        const height = document.getElementById("height").value;
        const depth = document.getElementById("depth").value;
        const dimensions = `${width} x ${height} x ${depth}`;
        document.getElementById("dimensions").value = dimensions;
    }

    function updateMiddleCategory() {
        const largeCategoryId = document.getElementById("largeCategory").value;
        const middleCategorySelect = document.getElementById("middleCategory");
        const smallCategorySelect = document.getElementById("smallCategory");

        // 중분류 초기화
        middleCategorySelect.innerHTML = "<option value=''>== 중분류 선택 ==</option>";
        smallCategorySelect.innerHTML = "<option value=''>== 소분류 선택 ==</option>";

        // 대분류에 해당하는 중분류 필터링
        const middleCategories = Object.values(categories).filter(cat => cat.parentId == largeCategoryId && cat.type === '중분류');
        middleCategories.forEach(category => {
            const option = document.createElement("option");
            option.value = category.id;
            option.textContent = category.name;
            middleCategorySelect.appendChild(option);
        });
    }

    function updateSmallCategory() {
        const middleCategoryId = document.getElementById("middleCategory").value;
        const smallCategorySelect = document.getElementById("smallCategory");

        // 소분류 초기화
        smallCategorySelect.innerHTML = "<option value=''>== 소분류 선택 ==</option>";

        // 중분류에 해당하는 소분류 필터링
        const smallCategories = Object.values(categories).filter(cat => cat.parentId == middleCategoryId && cat.type === '소분류');
        smallCategories.forEach(category => {
            const option = document.createElement("option");
            option.value = category.id;
            option.textContent = category.name;
            smallCategorySelect.appendChild(option);
        });
    }
</script>
</body>
</html>
