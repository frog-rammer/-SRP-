<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" th:href="@{/css/procuOneHeader.css}">
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <title>계약 비교 페이지</title>
  <style>
    /* 테이블 스타일 */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
    }

    th, td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: rgb(50, 146, 142); /* 테이블 헤더 색상 */
      color: white;
    }

    td {
      background-color: #f9f9f9;
    }

    tr:nth-child(even) td {
      background-color: #f2f2f2;
    }

    button {
      background-color: rgb(50, 146, 142); /* 버튼 색상 */
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: rgb(40, 126, 122); /* 버튼 hover 색상 */
    }

    .contract-button {
      text-decoration: none;
    }
  </style>
</head>
<body>
<div class="grid-container">
  <!-- 헤더-->
  <header class="layout-header">
    <div th:replace="partials/procuOneHeader :: header"></div>
  </header>

  <aside class="layout-sidebar">
    <div th:replace="partials/procuOneSide :: side"></div>
  </aside>

  <main class="layout-main">
    <header>
      <h1>계약 비교 페이지</h1>
      <p>다양한 회사들의 계약 조건을 비교하고, 원하는 계약을 선택하세요.</p>
    </header>

    <div id="productSelectWrapper">
      <label for="productSelect">품목 선택: </label>
      <select id="productSelect" onchange="updateTable()">
        <option value="">품목을 선택하세요</option>
        <!-- 품목을 동적으로 셀렉트 박스에 추가 -->
        <option th:each="item : ${items}"
                th:value="${item.productCode}"
                th:text="${item.itemName}"></option>
      </select>
    </div>

    <h2>계약 비교</h2>
    <table border="1" cellpadding="10" id="supplierTable">
      <thead>
      <tr>
        <th>회사명</th>
        <th>품목</th>
        <th>단가</th>
        <th>소요시간</th>
        <th>계약하기 버튼</th>
      </tr>
      </thead>
      <tbody>
      <!-- 테이블 내용은 JavaScript로 동적으로 갱신됨 -->
      </tbody>
    </table>

    <!-- 계약 관리 -->
<!--    <div class="form-section contract-management">-->
<!--      <h1>계약 관리</h1>-->
<!--      <div class="search-group">-->
<!--        &lt;!&ndash; 품목코드 셀렉트 (왼쪽 배치) &ndash;&gt;-->
<!--        <select>-->
<!--          <option>품목코드</option>-->
<!--        </select>-->

<!--        &lt;!&ndash; 여백 &ndash;&gt;-->
<!--        <div class="spacer"></div>-->

<!--        &lt;!&ndash; 텍스트 입력창 &ndash;&gt;-->
<!--        <input type="text">-->

<!--        &lt;!&ndash; 검색 버튼 &ndash;&gt;-->
<!--        <button type="submit">검색</button>-->
<!--      </div>-->

<!--      &lt;!&ndash; 테이블 &ndash;&gt;-->
<!--      <table>-->
<!--        <thead>-->
<!--        <tr>-->
<!--          <th>품목코드</th>-->
<!--          <th>품목명</th>-->
<!--          <th>계약번호</th>-->
<!--          <th>업체명</th>-->
<!--          <th>사업자번호</th>-->
<!--          <th>단가</th>-->
<!--          <th>L/T(소요시간)</th>-->
<!--          <th>계약서</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--          <td></td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--      </table>-->
<!--    </div>-->
  </main>

  <footer>
    <p>&copy; 2024 계약 비교 서비스</p>
  </footer>
</div>
<script>
  function updateTable() {
    var itemId = document.getElementById("productSelect").value;  // 선택된 품목 ID 가져오기

    if (itemId) {
      // POST 방식으로 품목 ID에 해당하는 공급업체 리스트를 서버로 전송
      fetch('/contract/suppliers', {
        method: 'POST', // POST 방식
        headers: {
          'Content-Type': 'application/json' // JSON 형식으로 보내기
        },
        body: JSON.stringify({ itemId: itemId }) // JSON 형식으로 전송
      })
              .then(response => response.json()) // 서버에서 받은 JSON 응답 처리
              .then(data => {
                var tableBody = document.getElementById("supplierTable").getElementsByTagName('tbody')[0];
                tableBody.innerHTML = ""; // 기존 내용 지우기

                // 공급업체 데이터 처리
                data.forEach(function(companyItem) {
                  var row = tableBody.insertRow(); // 새 행 추가
                  row.innerHTML = `
              <td>${companyItem.businessId}</td>   <!-- 회사명 -->
              <td>${companyItem.itemId}</td>       <!-- 품목명 -->
              <td>${companyItem.unitCost} 원</td>  <!-- 단가 -->
              <td>${companyItem.leadTime} 일</td>  <!-- 소요시간 -->
              <td><button onclick="contractWithCompany('${companyItem.businessId}')">계약하기</button></td>
          `;
                });
              })
              .catch(error => console.error('Error fetching suppliers:', error)); // 에러 처리
    }
  }


  function contractWithCompany(businessId) {
    alert(businessId + "와 계약을 진행합니다.");
    // 계약 진행 로직
    location.href = "/contract/contractWithCompany/" + businessId;
  }
</script>
</body>
</html>
