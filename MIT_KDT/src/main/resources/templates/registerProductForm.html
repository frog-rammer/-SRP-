<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>품목등록</title>
    <link rel="stylesheet" th:href="@{/css/procuOneHeader.css}">
</head>
<body>
<div th:replace="partials/procuOneHeader :: header"></div>
<h1>품목등록</h1>
<form th:action="@{/items/InputProduct}" th:object="${item}" method="post" enctype="multipart/form-data" onsubmit="combineDimensions()">
    <!-- 제품 코드 -->
    <div>
        <label for="productCode">제품 코드</label>
        <input type="text" th:field="*{productCode}" id="productCode" name="productCode" required/>
    </div>
    <!-- 품목명 -->
    <div>
        <label for="itemName">품목명</label>
        <input type="text" th:field="*{itemName}" id="itemName" name="itemName" required/>
    </div>
    <!-- 규격 -->
    <div>
        <label>규격</label>
        <input type="text" id="width" placeholder="가로(mm)" required/>
        <input type="text" id="height" placeholder="세로(mm)" required/>
        <input type="text" id="depth" placeholder="높이(mm)" required/>
        <input type="hidden" th:field="*{dimensions}" id="dimensions" name="dimensions" />
    </div>
    <!-- 분류 -->
    <div id="categoryDiv">
        <label>분류</label>
        <div id="dynamicCategorySelects">
            <select id="categorySelect_0" onchange="updateNextCategory(0)">
                <option value="">== 분류 선택 ==</option>
                <option th:each="category : ${categories}"
                        th:value="${category.id}"
                        th:text="${category.name}"
                        th:attr="data-type=${category.type}, data-parent-id=${category.parent != null ? category.parent.id : ''}"></option>
            </select>
        </div>
    </div>

    <!-- 도면파일 -->
    <div>
        <label for="drawingFile">도면파일</label>
        <input type="file" th:field="*{drawingFile}" id="drawingFile" name="drawingFile" />
    </div>

    <!-- 확인 버튼 -->
    <div>
        <button type="submit">확인</button>
        <button type="button" onclick="window.history.back()">취소</button>
    </div>
</form>

<script>
    function combineDimensions() {
        const width = document.getElementById("width").value;
        const height = document.getElementById("height").value;
        const depth = document.getElementById("depth").value;
        const dimensions = `${width} x ${height} x ${depth}`;
        document.getElementById("dimensions").value = dimensions;
    }

    function updateNextCategory(level) {
        const currentSelect = document.getElementById(`categorySelect_${level}`);
        const selectedCategoryId = currentSelect.value;

        // 다음 레벨의 셀렉트 박스 초기화 또는 제거
        const nextSelect = document.getElementById(`categorySelect_${level + 1}`);
        if (nextSelect) {
            nextSelect.remove();
        }

        // 선택된 카테고리가 없으면 종료
        if (!selectedCategoryId) {
            return;
        }

        // 새로운 셀렉트 박스 생성
        const newSelect = document.createElement("select");
        newSelect.id = `categorySelect_${level + 1}`;
        newSelect.onchange = function() { updateNextCategory(level + 1); };

        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "== 분류 선택 ==";
        newSelect.appendChild(defaultOption);

        // 현재 선택된 카테고리에 해당하는 하위 분류 추가
        Array.from(currentSelect.options).forEach(option => {
            if (option.dataset.parentId === selectedCategoryId) {
                const newOption = document.createElement("option");
                newOption.value = option.value;
                newOption.textContent = option.textContent;
                newOption.setAttribute("data-type", option.dataset.type);
                newOption.setAttribute("data-parent-id", option.dataset.parentId);
                newSelect.appendChild(newOption);
            }
        });

        // 새로운 셀렉트 박스를 DOM에 추가
        if (newSelect.options.length > 1) {
            document.getElementById("dynamicCategorySelects").appendChild(newSelect);
        }
    }
</script>
</body>
</html>
